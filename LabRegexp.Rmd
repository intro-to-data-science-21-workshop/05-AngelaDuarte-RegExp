---
title: "Regular Expressions (RegExp)"
author: "Anna Deniz / Ángela Duarte"
output: 
  html_document:
    toc: TRUE
    df_print: paged
    number_sections: FALSE
    highlight: tango
    theme: lumen
    toc_depth: 3
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

library(tidyverse)
library(stringr)
```
# Introduction

Regular Expressions, also known as Regexps, are used to describe and find patterns in strings. They are useful not only in R but in other languages as well. 

“Strictly speaking, they are not so much a tool as they are a convention on how to query strings across a wide range of functions.” [Munzert et al., Automated Data Collection with R] (https://bit.ly/3BdbkhS). 

They may look *very* complicated if you are seeing them for the first time, but it is actually not that hard once you understand how they work. In this tutorial, we are going to show you how to apply them using `Stringr`, a package from the Tidyverse used for string manipulation. 


---

# What are Regexps good for?

Regular Expressions are very useful for retrieving information from a messy data set of strings. It is an alternative when manipulating the string to find the information you want is too much work. All you have to do is come up with a pattern for what you want to pull out and write it using Regexps’ syntax. 

Using Regular Expressions with `Stringr` is very convenient, as many of the functions in this package use pattern as an input. 

Here is an example of how Regexp is used to get the right information from a messy data set of phone numbers:

```{r}

#phone_numbers <- c(
#<input german numbers in a messy way>)

#pattern <- #<input pattern>

#str_match(phone_numbers, pattern)

```

Now, let's see how you can develop your own Regex for your own messy data set!

---
# Key expressions
To test the key features, let's use this data set:

```{r}

#data_set <- #<input data set for examples>

```
We will also use the function ‘str_match’ from the package Stringr, which receives as input the string and a pattern. In our case, the pattern will be the Regular Expression.

The simplest Regular Expression “abc”. Its does <input what it does>

```{r}

#pattern <- #<input regex for key feature>

#str_match(data_set, pattern)

```

 \d = Digit (0–9)
 \w = Word Character (a-z, A-Z, 0–9, _)
 \s = Whitespace (space, tab, newline)
 . = Matches Any Character (Wild card)
 + = 1 or more
 * = 0 or more
 [ ] = Matches characters or brackets
 ( ) = Group
 "|" = Either Or
 "{x}" = Exact Number
 "^" = Beginning of a string
 "$" = End of a String

<Note on Upper case commands. Note on “Escape \”.>

Now, let's practice!

---


# How can you use RegExp to solve problems? Using Combinations

Consider the following list of school objects:

```{r}
school_things=c("notebooks 450", "sheets 1000", "pencils 457", "colors 157", "nothing")
```

We will practice 5 combinations of the "Key Expressions" used above to do some interesting text manipulation. Let's start!

1. What if we wanted to get all elements from a certain kind in the `school_things` vector?

```{r}
str_match(school_things, "\\d+")
```
This `"\\d+"` means:"give me one or more digits from the vector `school_things`.

Similarly, we can use `"\\w+"` to get all the alpha numeric characters and `"\\s+"` to get all whitespaces. How would you translate them to plain English? 

```{r}
str_match(school_things, "\\w+") 
str_match(school_things, "\\s+") 
```


2. Separating numbers from the words. Hint: Use the expressions practiced in 1), `()` to group the strings and `\\W*` to remove all white spaces.  

```{r}
new_pattern="(\\w*)\\W*(\\d*)"
str_match(school_things, new_pattern)
```
Notice that the result is a matrix in which the columns are the vector itself, its alphanumeric values and its digits. 

3. How can we find the expressions that start with "not" on the vector? 

Let's learn the power of pattern matching!
```{r}

str_match(school_things, "^not.*")

```


4. Practicing conditions by finding the expressions that start with "n" or "p". 
```{r}
str_match(school_things, "[n|p].*")
```

5. Grouping with conditions! Take the words that have two repeated vowels.

```{r}
str_match(school_things,"\\w*(a|e|i|o|u){2}.")
```



---

# Try it yourself!

As we said before, regular expressions are conventions to find and manipulate patterns in text data. Using the `str_match` function from the `stringr` package we can try out these conventions! 

*Note*: other `stringr` functions can be used with regular expressions, but we will not explain them because it is not the subject of our workshop. We invite you to go to the “String Manipulation with R” presentation to learn more about this package!

Before starting, some **reminders**:

1.  Practice makes perfect! You might not get the expression you want at first, but with patience and a little work you'll eventually get where you want.Remember you can always use the [_"R Regex Texter"_](https://spannbaueradam.shinyapps.io/r_regex_tester/) to test your work. 

2. Read RegExps out loud to understand them! It is easier to remember them if you understand what they mean. For example, "slash d plus"(`"\\d+`) doesn't make sense until you remember that it means "give me one or more digits together"). (We thank Colin Quirk for this advice. You can see his tutorial, [_here_](https://www.youtube.com/watch?v=uJKpz9T7mAg). 

3. Remember that R looks for Regexp sequentially. This means that it will stop searching once it finds the patterns. This means that if you want to get more complicated expressions, you need to keep your repetition operators close and the brackets even closer!

Let's do this!

**Exercise 1: **

Imagine you decided to digitize one of your old notebooks and found the following vector. 

```{r}
contact_list <- c(" lisa 444-4444-5555", "Anna: 456 777-9898", "kevin’s number 344 456 632", "juan has no number", "576 987 678") 
```

*How would you separate numbers from words and place them on a matrix?*

**Solution 1**

We will use the expressions we have learned so far to do this. **Remember to "read" the RegExp out loud!** 

1. We want to get the words in our vector first. Let's try `\\w*` to get them. 

```{r}
str_match(contact_list, "\\w*")
```

`\\w*` didn't take all the text in the vector. Why? Three things happened: 

  - `\\w` takes alphanumeric characters, which include integers. This explains why "576" is is the 5th row.

  - Notice that by using `*` the Regexp `\\w*` takes "zero or more" alphanumeric characters. Since in the first row there is a space before "lisa", this space accounts for the "zero" alphanumeric characters 

  - Also, since `str_match` looks for the patterns sequentially, it stops once it finds them. This is why, it stops after getting the space in row 1 and after getting the first words in rows 2-4.

This problem is partially solved by using `\\w+`. What is missing? 
```{r}
str_match(contact_list, "\\w+")
```
Since `\\w+` still takes numeric values, and it stops at the end of the first word. This is why, we can use `\\D+` instead (remember that it reads: "R, give me one or more non-digits").

```{r}
str_match(contact_list, "\\D+")
```


2. Now, let's try and take all the numerical characters from each expression with `\\d`(which reads *"R, Give me one or more digits"*). Notice that it is better not to use `\\d*`in this exercise because the `+`asks for "zero or more", which may return empty strings.

```{r}
str_match(contact_list, "\\d*")
str_match(contact_list, "\\d+")
```

We have the same problem as before, this to
```{r}

```


3. Putting it all together with grouping operators.

```{r}
str_match(contact_list, "\\w*(\\d{3}).*(\\d{3}).*(\\d{4})")
```



**Exercise 2: **
```{r}
text1 <- sentences[1:50]
text1
```

Look for specific words: 
```{r}
colors=c("red", "orange", "yellow", "green", "blue", "purple")
color_match=str_c(colors, collapse = "|")
str_match(text1,color_match)
```

2. separate the words in a matrix
```{r}
str_match(text1,"(\\w*)\\W*(\\w*)\\W*(\\w*)\\W*(\\w*)\\W*(\\w*)\\W*(\\w*)\\W*(\\w*)")
```


---


# Where should you go to learn more

There are a bunch of cheat sheets out there. We recommend this one: XXX. If you want to practice using regular expressions, you can also go to [this website](https://regexone.com/).
 

---

# Sources {-}

1. [_R for Data Science_](https://r4ds.had.co.nz/strings.html)
2. [_Automated Data Collection with R. A Practical Guide to Web Scraping and Text Mining_](https://onlinelibrary.wiley.com/doi/book/)
3. [_Interactive Tutorial on Regular Expressions_](https://regexone.com/)
4. [_R Tutorial | Regular Expressions in R_](https://www.youtube.com/watch?v=uJKpz9T7mAg)


